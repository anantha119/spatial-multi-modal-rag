<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1300 680" font-family="Inter, -apple-system, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#374151"/>
    </marker>
    <marker id="arrow-dash" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#9CA3AF"/>
    </marker>
  </defs>
  <rect width="1300" height="680" fill="#FAFAFA" rx="8"/>
  <text x="650" y="34" text-anchor="middle" font-size="18" font-weight="700" fill="#111827">Multimodal RAG System Architecture</text>
  <g id="offline-pipeline">
    <rect x="24" y="52" width="370" height="600" rx="8" fill="white" stroke="#E5E7EB" stroke-width="1.5"/>
    <rect x="24" y="52" width="370" height="34" rx="8" fill="#F3F4F6"/>
    <rect x="24" y="74" width="370" height="12" fill="#F3F4F6"/>
    <text x="209" y="76" text-anchor="middle" font-size="13" font-weight="600" fill="#374151">OFFLINE · Indexing Pipeline</text>
    <rect x="54" y="105" width="150" height="42" rx="6" fill="#EFF6FF" stroke="#BFDBFE" stroke-width="1.2"/>
    <text x="129" y="131" text-anchor="middle" font-size="12" font-weight="500" fill="#1E40AF">AI2D Dataset</text>
    <rect x="54" y="160" width="150" height="42" rx="6" fill="#EFF6FF" stroke="#BFDBFE" stroke-width="1.2"/>
    <text x="129" y="186" text-anchor="middle" font-size="12" font-weight="500" fill="#1E40AF">ChartQA Dataset</text>
    <rect x="244" y="130" width="130" height="46" rx="6" fill="#FEF3C7" stroke="#FCD34D" stroke-width="1.2"/>
    <text x="309" y="149" text-anchor="middle" font-size="11" font-weight="600" fill="#92400E">Deduplication</text>
    <text x="309" y="166" text-anchor="middle" font-size="10" fill="#A16207">MD5 hashing</text>
    <path d="M 204 126 L 224 126 L 224 144 L 244 144" fill="none" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <path d="M 204 181 L 224 181 L 224 163 L 244 163" fill="none" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <rect x="54" y="230" width="150" height="46" rx="6" fill="#F0FDF4" stroke="#BBF7D0" stroke-width="1.2"/>
    <text x="129" y="249" text-anchor="middle" font-size="11" font-weight="600" fill="#166534">Text Documents</text>
    <text x="129" y="265" text-anchor="middle" font-size="10" fill="#15803D">35,807 QA pairs</text>
    <rect x="244" y="230" width="130" height="46" rx="6" fill="#FDF2F8" stroke="#FBCFE8" stroke-width="1.2"/>
    <text x="309" y="249" text-anchor="middle" font-size="11" font-weight="600" fill="#9D174D">Image Documents</text>
    <text x="309" y="265" text-anchor="middle" font-size="10" fill="#BE185D">21,633 images</text>
    <path d="M 309 176 L 309 200 L 129 200 L 129 230" fill="none" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <path d="M 309 176 L 309 230" fill="none" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <rect x="160" y="210" width="110" height="18" rx="4" fill="#FEF3C7" stroke="#FDE68A" stroke-width="1"/>
    <text x="215" y="223" text-anchor="middle" font-size="9" font-weight="600" fill="#92400E">linked by group_id</text>
    <rect x="54" y="325" width="150" height="50" rx="6" fill="#DBEAFE" stroke="#93C5FD" stroke-width="1.2"/>
    <text x="129" y="346" text-anchor="middle" font-size="11" font-weight="600" fill="#1E40AF">MiniLM-L6-v2</text>
    <text x="129" y="363" text-anchor="middle" font-size="10" fill="#2563EB">384-dim text encoder</text>
    <rect x="244" y="325" width="130" height="50" rx="6" fill="#DBEAFE" stroke="#93C5FD" stroke-width="1.2"/>
    <text x="309" y="346" text-anchor="middle" font-size="11" font-weight="600" fill="#1E40AF">CLIP ViT-B/32</text>
    <text x="309" y="363" text-anchor="middle" font-size="10" fill="#2563EB">512-dim vision encoder</text>
    <line x1="129" y1="276" x2="129" y2="320" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <line x1="309" y1="276" x2="309" y2="320" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <rect x="54" y="425" width="150" height="50" rx="6" fill="#F5F3FF" stroke="#C4B5FD" stroke-width="1.2"/>
    <text x="129" y="446" text-anchor="middle" font-size="11" font-weight="600" fill="#5B21B6">mmrag_text</text>
    <text x="129" y="463" text-anchor="middle" font-size="10" fill="#7C3AED">ChromaDB HNSW</text>
    <rect x="244" y="425" width="130" height="50" rx="6" fill="#F5F3FF" stroke="#C4B5FD" stroke-width="1.2"/>
    <text x="309" y="446" text-anchor="middle" font-size="11" font-weight="600" fill="#5B21B6">mmrag_image</text>
    <text x="309" y="463" text-anchor="middle" font-size="10" fill="#7C3AED">ChromaDB HNSW</text>
    <line x1="129" y1="375" x2="129" y2="420" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <line x1="309" y1="375" x2="309" y2="420" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
  </g>
  <g id="document-store">
    <rect x="424" y="280" width="140" height="110" rx="8" fill="white" stroke="#D1D5DB" stroke-width="1.5"/>
    <rect x="424" y="280" width="140" height="28" rx="8" fill="#F9FAFB"/>
    <rect x="424" y="296" width="140" height="12" fill="#F9FAFB"/>
    <text x="494" y="298" text-anchor="middle" font-size="11" font-weight="600" fill="#374151">Document Store</text>
    <text x="494" y="325" text-anchor="middle" font-size="10" fill="#6B7280">text_documents</text>
    <text x="494" y="340" text-anchor="middle" font-size="10" fill="#6B7280">.json</text>
    <text x="494" y="362" text-anchor="middle" font-size="10" fill="#6B7280">image_documents</text>
    <text x="494" y="377" text-anchor="middle" font-size="10" fill="#6B7280">.json</text>
    <path d="M 204 253 C 320 253, 320 310, 415 310" fill="none" stroke="#9CA3AF" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#arrow-dash)"/>
    <path d="M 374 253 C 390 253, 400 360, 415 360" fill="none" stroke="#9CA3AF" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#arrow-dash)"/>
  </g>
  <g id="online-pipeline">
    <rect x="594" y="52" width="682" height="600" rx="8" fill="white" stroke="#E5E7EB" stroke-width="1.5"/>
    <rect x="594" y="52" width="682" height="34" rx="8" fill="#F3F4F6"/>
    <rect x="594" y="74" width="682" height="12" fill="#F3F4F6"/>
    <text x="935" y="76" text-anchor="middle" font-size="13" font-weight="600" fill="#374151">ONLINE · Inference Pipeline</text>
    <ellipse cx="700" cy="126" rx="65" ry="22" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1.2"/>
    <text x="700" y="131" text-anchor="middle" font-size="13" font-weight="600" fill="#92400E">Query</text>
    <rect x="630" y="180" width="140" height="38" rx="6" fill="#DBEAFE" stroke="#93C5FD" stroke-width="1.2"/>
    <text x="700" y="204" text-anchor="middle" font-size="11" font-weight="500" fill="#1E40AF">MiniLM Query Enc.</text>
    <rect x="630" y="232" width="140" height="38" rx="6" fill="#DBEAFE" stroke="#93C5FD" stroke-width="1.2"/>
    <text x="700" y="256" text-anchor="middle" font-size="11" font-weight="500" fill="#1E40AF">CLIP Query Enc.</text>
    <line x1="700" y1="148" x2="700" y2="175" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <line x1="700" y1="218" x2="700" y2="227" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <rect x="815" y="180" width="110" height="38" rx="6" fill="#F0FDF4" stroke="#BBF7D0" stroke-width="1.2"/>
    <text x="870" y="204" text-anchor="middle" font-size="11" font-weight="600" fill="#166534">Text Top-K</text>
    <rect x="815" y="232" width="110" height="38" rx="6" fill="#FDF2F8" stroke="#FBCFE8" stroke-width="1.2"/>
    <text x="870" y="256" text-anchor="middle" font-size="11" font-weight="600" fill="#9D174D">Image Top-K</text>
    <line x1="770" y1="199" x2="807" y2="199" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <line x1="770" y1="251" x2="807" y2="251" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <path d="M 204 450 C 480 450, 480 199, 807 199" fill="none" stroke="#9CA3AF" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#arrow-dash)"/>
    <path d="M 374 450 C 520 450, 520 251, 807 251" fill="none" stroke="#9CA3AF" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#arrow-dash)"/>
    <rect x="970" y="180" width="110" height="38" rx="6" fill="#FEF3C7" stroke="#FCD34D" stroke-width="1.2"/>
    <text x="1025" y="197" text-anchor="middle" font-size="11" font-weight="600" fill="#92400E">Print IDs</text>
    <text x="1025" y="212" text-anchor="middle" font-size="10" fill="#A16207">+ Scores</text>
    <line x1="925" y1="199" x2="962" y2="199" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <path d="M 925 251 L 947 251 L 947 205 L 962 205" fill="none" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <rect x="970" y="235" width="110" height="26" rx="4" fill="#FEF2F2" stroke="#FECACA" stroke-width="1.2"/>
    <text x="1025" y="252" text-anchor="middle" font-size="9" font-weight="500" fill="#991B1B">Score threshold gate</text>
    <line x1="1025" y1="218" x2="1025" y2="235" stroke="#DC2626" stroke-width="1.5" stroke-dasharray="3,2"/>
    <rect x="790" y="320" width="200" height="56" rx="6" fill="#DBEAFE" stroke="#60A5FA" stroke-width="1.5"/>
    <text x="890" y="343" text-anchor="middle" font-size="12" font-weight="700" fill="#1E40AF">Context Builder</text>
    <text x="890" y="359" text-anchor="middle" font-size="10" fill="#2563EB">Bidirectional group_id linkage</text>
    <text x="890" y="371" text-anchor="middle" font-size="10" fill="#2563EB">valid_ids allowlist</text>
    <line x1="870" y1="270" x2="870" y2="313" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <path d="M 564 335 C 670 335, 670 348, 782 348" fill="none" stroke="#9CA3AF" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#arrow-dash)"/>
    <rect x="635" y="340" width="80" height="16" rx="4" fill="white" stroke="#E5E7EB" stroke-width="1"/>
    <text x="675" y="351" text-anchor="middle" font-size="9" font-weight="500" fill="#6B7280">group_id lookup</text>
    <rect x="825" y="415" width="130" height="42" rx="6" fill="#F0FDF4" stroke="#86EFAC" stroke-width="1.2"/>
    <text x="890" y="434" text-anchor="middle" font-size="11" font-weight="600" fill="#166534">Evidence</text>
    <text x="890" y="449" text-anchor="middle" font-size="10" fill="#15803D">text + image paths</text>
    <line x1="890" y1="376" x2="890" y2="408" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <rect x="810" y="495" width="160" height="52" rx="8" fill="#EDE9FE" stroke="#8B5CF6" stroke-width="1.5"/>
    <text x="890" y="517" text-anchor="middle" font-size="13" font-weight="700" fill="#5B21B6">Qwen3-VL-8B</text>
    <text x="890" y="535" text-anchor="middle" font-size="10" fill="#7C3AED">Images as visual tokens + text</text>
    <line x1="890" y1="457" x2="890" y2="488" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <rect x="825" y="585" width="130" height="42" rx="6" fill="#FEF2F2" stroke="#FECACA" stroke-width="1.2"/>
    <text x="890" y="603" text-anchor="middle" font-size="11" font-weight="600" fill="#991B1B">Citation Validator</text>
    <text x="890" y="618" text-anchor="middle" font-size="10" fill="#DC2626">regex vs valid_ids</text>
    <line x1="890" y1="547" x2="890" y2="578" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
    <ellipse cx="1130" cy="606" rx="80" ry="24" fill="#F0FDF4" stroke="#22C55E" stroke-width="1.5"/>
    <text x="1130" y="603" text-anchor="middle" font-size="12" font-weight="700" fill="#166534">Grounded</text>
    <text x="1130" y="618" text-anchor="middle" font-size="12" font-weight="700" fill="#166534">Answer</text>
    <line x1="955" y1="606" x2="1042" y2="606" stroke="#374151" stroke-width="1.2" marker-end="url(#arrow)"/>
  </g>
</svg>